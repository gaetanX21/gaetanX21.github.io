<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Diffusion Schrödinger Bridge | Gaëtan Ecrepont </title> <meta name="author" content="Gaëtan Ecrepont"> <meta name="description" content="Theoretical study of the Schrödinger Bridge problem &amp; PyTorch implementation of the Diffusion Schrödinger Bridge algorithm to study convergence properties in the Gaussian case."> <meta name="keywords" content="portfolio-website, machine-learning, statistics, quantitative-finance"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%98%84%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://gaetanx21.github.io/projects/dsb/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Gaëtan</span> Ecrepont </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Diffusion Schrödinger Bridge</h1> <p class="post-description">Theoretical study of the Schrödinger Bridge problem &amp; PyTorch implementation of the Diffusion Schrödinger Bridge algorithm to study convergence properties in the Gaussian case.</p> </header> <article> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/dsb/troll2torch-480.webp 480w,/assets/img/dsb/troll2torch-800.webp 800w,/assets/img/dsb/troll2torch-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/dsb/troll2torch.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="DSB example" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Theoretical study of the Schrödinger Bridge problem &amp; PyTorch implementation of the Diffusion Schrödinger Bridge algorithm to study convergence properties in the Gaussian case. </div> <p>NB: This post is just a recap of my work, but you can get my full report <a href="https://github.com/gaetanX21/dsb-gaussian/blob/main/report/report.pdf" rel="external nofollow noopener" target="_blank">here</a>.</p> <h2 id="project-overview">Project Overview</h2> <p>Schrödinger Bridges (SB) generalize Optimal Transport by specifying not <em>where</em> but <em>how</em> to transport mass from one distribution to another, given a reference dynamic. Generative modeling can be achieved by finding SBs to go from $p_\textnormal{prior}$ to $p_\textnormal{data}$, which amounts to solving a <em>dynamic</em> SB problem. De Bortoli et al.<sup id="fnref:dsb"><a href="#fn:dsb" class="footnote" rel="footnote" role="doc-noteref">1</a></sup> introduced the Diffusion Schrödinger Bridge (DSB) model, a variational approach to the Iterative Proportional Fitting (IPF) algorithm to solve the <em>discrete dynamic</em> SB problem. DSB generalizes score-based generative modeling (SGM) introduced by Song et al<sup id="fnref:sde"><a href="#fn:sde" class="footnote" rel="footnote" role="doc-noteref">2</a></sup>., and has stronger theoretical guarantees, in particular $p_T=p_\textnormal{prior}$.</p> <p>This project constitutes a theoretical and practical introduction to DSB. Our contribution is to explicit the closed-form solution of the <em>discrete dynamic</em> SB problem in the Gaussian case, and leverage this closed-form expression to assess the performance of the DSB model in various settings by varying the dimension and complexity of $p_\textnormal{data}$ and $p_\textnormal{prior}$. In particular, we demonstrate that setting $L=20$ DSB iterations as in the original paper amounts to <em>under-training</em> the DSB model.</p> <h2 id="the-schrödinger-bridge-problem">The Schrödinger Bridge Problem</h2> <p>Let’s first present the Schrödinger Bridge problem, which is the theoretical framework behind the DSB model. We will limit ourselves to the intuitive formulation of the SB problem from statistical physics.</p> <p>The Schrödinger Bridge (SB) problem was introduced in 1932 by Schrödinger <sup id="fnref:schrodinger"><a href="#fn:schrodinger" class="footnote" rel="footnote" role="doc-noteref">3</a></sup> and asks the following question:</p> <blockquote> <p>Let $S$ be a particle system composed of a large number of independent particles following a Brownian motion. We observe $S\sim \nu_0$ at time $0$ and $S\sim \nu_1$ at time $T$. What is the most likely dynamical behavior of $S$ between $0$ and $T$ ?</p> </blockquote> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/dsb/sb-statphy-480.webp 480w,/assets/img/dsb/sb-statphy-800.webp 800w,/assets/img/dsb/sb-statphy-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/dsb/sb-statphy.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="SB as a statistical physics problem." loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> SB as a statistical physics problem. </div> <p>In other words, the SB problem imposes an initial distribution $\nu_0$, a final distribution $\nu_1$ and a <em>reference dynamic</em> (here the Brownian motion i.e. diffusion according to the heat equation, but the SB problem can be generalized to any specified dynamics) and looks for the <em>distribution on paths</em> $P$ which matches $\nu_0$ at time $0$ and $\nu_1$ at time $T$ while staying as close as possible to the reference dynamics between $0$ and $T$.</p> <p>Note that by setting $\nu_0=p_\textnormal{data}$ and $\nu_1=p_\textnormal{prior}$ we recover generative modeling.</p> <h2 id="the-iterative-proportional-fitting-algorithm">The Iterative Proportional Fitting Algorithm</h2> <p>To solve the SB problem, we use the Iterative Proportional Fitting (IPF) algorithm. It is a <em>discrete</em> algorithm, meaning that it approximates the <em>continuous</em> SB problem by discretizing the time interval $[0,T]$ into $N$ steps. The IPF algorithm is an alternative projection scheme w.r.t. to the Kullback-Leibler divergence which starts from an initial bridge $P_0$ and iteratively refines it according to the following two-step procedure:</p> <ol> <li> <strong>Forward step</strong>: Given the bridge $P^{2n}: x_0 \sim p_\textnormal{data} \rightarrow x_T \sim p_\textnormal{prior}$, compute the bridge $P^{2n+1}: x_T \sim p_\textnormal{prior} \rightarrow x_0 \sim p_\textnormal{data}$ by starting from $x_T \sim p_\textnormal{prior}$ and using the reverse transitions of $P^{2n}$.</li> <li> <strong>Backward step</strong>: Given the bridge $P^{2n+1}: x_T \sim p_\textnormal{prior} \rightarrow x_0 \sim p_\textnormal{data}$, compute the bridge $P^{2n+2}: x_0 \sim p_\textnormal{data} \rightarrow x_T \sim p_\textnormal{prior}$ by starting from $x_0 \sim p_\textnormal{data}$ and using the reverse transitions of $P^{2n+1}$. Under mild conditinos on $p_\textnormal{data}$ and $p_\textnormal{prior}$, the IPF algorithm converges to a fixed point $S$ which is the (unique) solution to the SB problem. Note that $P^0$ is obtained by starting from $p_\textnormal{data}$ and using the transitions of the reference dynamic.</li> </ol> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/dsb/ipfp_illustration-480.webp 480w,/assets/img/dsb/ipfp_illustration-800.webp 800w,/assets/img/dsb/ipfp_illustration-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/dsb/ipfp_illustration.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="IPF" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> The IPF algorithm amounts to iteratively solving half-bridges (i.e. projecting with respect to the KL divergence) until convergence to a fixed point denoted by $S$ here </div> <p>The only difficulty in implementing IPF is that the reverse transitions are not known in closed-form. This is where the DSB model comes into play. Basically, DSB models all transitions as Gaussian kernels in such a way that the reverse transitions can be approximated in closed-form. However, this closed-form approximation still requires computing Stein scores (i.e. expressions of the form $\nabla_x \log p(x)$). We use score-matching to estimate these scores, yielding the DSB model.</p> <h2 id="the-gaussian-case">The Gaussian Case</h2> <p>In the Gaussian case (i.e. when both $p_\textnormal{data}$ and $p_\textnormal{prior}$ are Gaussian), there is a closed-form solution to the SB problem. This is useful because it means that we can apply DSB in the Gaussian case and compare the experimental results to the closed-form solution, so as to assess the performance of the DSB model.</p> <p>Let $p_\textnormal{data} \sim N(0, \Sigma)$ and $p_\textnormal{prior} \sim N(0, \Sigma’)$. Note that for conciseness we center on the origin, but it doesn’t remove much generality since the hard part is learning the covariance.</p> <p>The metric we use to assess the performance of the DSB model is the Frobenius norm of the difference $\hat{\Sigma} - \Sigma$ between the estimated covariance matrix $\hat{\Sigma}$ and the ground truth $\Sigma$. Note that the covariance matrix is estimated empirically from $M=250,000$ samples once the DSB model has converged.</p> <p>To measure performance in different settings, we will vary the <strong>dimension</strong> of the Gaussian distributions ($d\in \lbrace 1,5, 10 \rbrace$), the <strong>complexity</strong> of the covariance matrices (spherical, diagonal or general), and the number of iterations of the DSB model (i.e. the number $L$ of IPF steps). In particular, we will show that setting $L=20$ DSB iterations as in the original paper amounts to <em>under-training</em> the DSB model. Note that for each setting we run $n_\textnormal{exp}=25$ experiments to average out the noise.</p> <h2 id="numerical-findings">Numerical findings</h2> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/dsb/sph_sigma-480.webp 480w,/assets/img/dsb/sph_sigma-800.webp 800w,/assets/img/dsb/sph_sigma-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/dsb/sph_sigma.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="spherical" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/dsb/dia_sigma-480.webp 480w,/assets/img/dsb/dia_sigma-800.webp 800w,/assets/img/dsb/dia_sigma-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/dsb/dia_sigma.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="diagonal" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/dsb/gen_sigma-480.webp 480w,/assets/img/dsb/gen_sigma-800.webp 800w,/assets/img/dsb/gen_sigma-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/dsb/gen_sigma.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="general" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Numerical results obtained by training DSB in Gaussian case and comparing to ground truth. </div> <p>The solid lines represent the mean error (computed over the $n_\textnormal{exp}$ experiments) as a function of the DSB iteration $n$, and the shaded areas depict the uncertainty over the estimated errors ($\pm1$std computed over the $n_\textnormal{exp}$ experiments). In all plots, the error increases with $d$ and decreases with $n$, as expected. Likewise, the variance of the error tends to diminish with $n$, which makes sense because each IPF step brings us closer to convergence.</p> <p>We observe that the error follows the same decreasing pattern and the overall error levels follow the expected order of difficulty $spherical &lt; diagonal &lt; general$. In addition, despite the cogent shape of the error curve, the final error values (i.e. for $n=L$) are still one order of magnitude higher than the noise threshold, which implies that the IPF algorithm used by DSB is still <em>far from convergence</em>.</p> <h2 id="critics--conclusion">Critics &amp; Conclusion</h2> <p>There are a few critics regarding our results:</p> <ol> <li>We limited ourselves to the Gaussian case, which is a strong assumption. However, it is a good starting point to understand the behavior of the DSB model.</li> <li>For lack of sufficient computational resources, we had to limit ourselves to low dimensions. However DSB is meant to be applied in high dimensional settings such as image generation.</li> <li> <em>A priori</em>, the error term $| \hat{\Sigma}-\Sigma |_F$ is contaminated with noise from the estimation of $\hat{\Sigma}$ and as such it overestimates the actual error, by an amount which is not trivial to determine, especially in higher dimensions.</li> </ol> <p>Nonetheless, our results are consistent with the theoretical guarantees of the DSB model, and we have shown that setting $L=20$ DSB iterations as in the original paper amounts to <em>under-training</em> the DSB model. This is a first step towards understanding the convergence properties of the DSB model, and we hope that future work will address the critics we raised.</p> <p><strong>References</strong>:</p> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:dsb"> <p><em>Diffusion Schrödinger Bridge with Applications to Score-Based Generative Modeling</em>. De Bortoli et al. <a href="https://arxiv.org/abs/2106.01357" rel="external nofollow noopener" target="_blank">arXiv</a> <a href="#fnref:dsb" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:sde"> <p><em>Score-Based Generative Modeling through Stochastic Differential Equations</em>. Yang Song et al. <a href="https://arxiv.org/abs/2011.13456" rel="external nofollow noopener" target="_blank">arXiv</a> <a href="#fnref:sde" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:schrodinger"> <p><em>Sur la théorie relativiste de l’électron et l’interprétation de la mécanique quantique</em>. Erwin Schrödinger. <a href="#fnref:schrodinger" class="reversefootnote" role="doc-backlink">↩</a></p> </li> </ol> </div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Gaëtan Ecrepont. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> </body> </html>